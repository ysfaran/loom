---
import '../styles.css';
import { routes } from '../generated/routes';
import H1 from '../components/mdx/H1.astro';
import H2 from '../components/mdx/H2.astro';
import H3 from '../components/mdx/H3.astro';
import H4 from '../components/mdx/H4.astro';
import H5 from '../components/mdx/H5.astro';
import H6 from '../components/mdx/H6.astro';
import Link from '../components/mdx/Link.astro';

const activeRoute = routes.find((route) => route.path === '/') ?? routes[0];

if (!activeRoute) {
  throw new Error('No MDX routes found to render.');
}

const modules = import.meta.glob('../../content/**/*.mdx');
const moduleKey = `../../content/${activeRoute.file}`;
const loader = modules[moduleKey];

if (!loader) {
  throw new Error(`Unable to load MDX file: ${activeRoute.file}`);
}

const loaded = await loader();
const Content = loaded.default;

const components = {
  h1: H1,
  h2: H2,
  h3: H3,
  h4: H4,
  h5: H5,
  h6: H6,
  a: Link
};
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Loom Docs</title>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div class="grid min-h-screen grid-cols-1 md:grid-cols-[280px_1fr]">
      <aside class="border-b border-slate-200 bg-white p-4 md:border-b-0 md:border-r">
        <h2 class="mb-3 text-xs font-semibold uppercase tracking-wide text-slate-500">Docs</h2>
        <ul class="grid gap-2">
          {routes.map((route) => (
            <li>
              <a class="text-sm text-slate-900 no-underline hover:text-sky-600" href={route.path}>
                {route.path}
              </a>
            </li>
          ))}
        </ul>
      </aside>
      <main class="p-6">
        <article class="prose prose-slate prose-a:text-sky-600 prose-a:no-underline hover:prose-a:underline max-w-none">
          <Content components={components} />
        </article>
      </main>
    </div>
  </body>
</html>
